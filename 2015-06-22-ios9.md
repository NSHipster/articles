---
title: iOS 9
author: David Liu
category: ""
excerpt: "WWDC 2015 è™½ä¸åƒå¾€å±Šé‚£æ ·ç²¾å½©çº·å‘ˆï¼Œä½†å´ä¸æ¯«ä¸ç¼ºä¹äº®ç‚¹ã€‚è¿™å‘¨æˆ‘ä»¬å°†ä¸€èµ·æ¢è®¨ iOS 9 ç»™æˆ‘ä»¬ç†Ÿæ‚‰å’Œçƒ­çˆ±çš„ API å¸¦æ¥äº†å“ªäº›æ”¹è¿›ã€‚"
---

WWDC 2015 è™½ä¸åƒå¾€å±Šé‚£æ ·ç²¾å½©çº·å‘ˆï¼Œä½†å´ä¸æ¯«ä¸ç¼ºä¹äº®ç‚¹ã€‚ watchOS 2 åŒ…å«æ”¹è‰¯è¿‡çš„ WatchKitï¼ŒApple Watch ç¡¬ä»¶è®¿é—®æƒé™ä»¥åŠè¡¨ç›˜æ’ä»¶æ”¯æŒã€‚Swift ä¹Ÿæœ‰å¤§é‡æ”¹è¿›ï¼Œå¹¶ä¸”å®£å¸ƒäº†æœªæ¥çš„å¼€æºè®¡åˆ’ã€‚å…¨æ–°çš„æ¡†æ¶ï¼ŒåŒ…æ‹¬ï¼šContactsï¼ŒContactsUI å’Œ CoreSpotlightï¼Œè¿˜æœ‰ä¸€äº›æ–° UIKit ç±»å‹ï¼Œæ¯”å¦‚ï¼š`UIStackView`ï¼Œ`SFSafariViewController`ã€‚

æˆ‘ä»¬ä¼šåœ¨æœªæ¥æ•°å‘¨ç”šè‡³æ•°æœˆå†…æ·±å…¥åœ°æ¢è®¨è¿™äº›ä¸»è¦çš„æ”¹è¿›ã€‚ä¸è¿‡ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆæ¥ä¸€èµ·çœ‹çœ‹ iOS 9 ç»™æˆ‘ä»¬ç†Ÿæ‚‰å’Œçƒ­çˆ±çš„ API å¸¦æ¥äº†å“ªäº›æ”¹è¿›ã€‚


* * *


## å­—ç¬¦ä¸²å˜å½¢

ä»¥å‰æ·±è—åœ¨ Core Foundation çš„å­—ç¬¦ä¸²å˜å½¢è¿™æ¬¡è¢«å¸¦åˆ°äº† `NSString` å’Œ Swift `String` ä¸­ã€‚è¿™è®© Cocoa è¿™é¡¹å¼ºå¤§åŠŸèƒ½å˜å¾—ååˆ†æ˜“ç”¨ï¼Œå› ä¸ºä¸ç”¨å†å»ç†ä¼šæ¡¥æ¥ `CFStringRef` æ‰€å¸¦æ¥çš„éº»çƒ¦ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨æ–° `NSStringTransform*` å¸¸é‡æ¥è¿›è¡Œå­—ç¬¦ä¸²å˜å½¢çš„ä¾‹å­ï¼š

### éŸ³è¯‘

```swift
"privet".stringByApplyingTransform(NSStringTransformLatinToCyrillic, reverse: false)
// "Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚"
"ì•ˆë…•í•˜ì„¸ìš”".stringByApplyingTransform(NSStringTransformLatinToHangul, reverse: true)
// "annyeonghaseyo"
"annyeonghaseyo".stringByApplyingTransform(NSStringTransformLatinToHangul, reverse: false)
// "ì•ˆë…•í•˜ì„¸ìš”"
```
```objective-c
NSLog(@"%@", [@"privet" stringByApplyingTransform:NSStringTransformLatinToCyrillic reverse:NO]);
// "Ğ¿Ñ€Ğ¸Ğ²ĞµÑ‚"
NSLog(@"%@", [@"annyeonghaseyo" stringByApplyingTransform:NSStringTransformLatinToHangul reverse:NO]);
// "ì•ˆë…•í•˜ì„¸ìš”"
NSLog(@"%@", [@"ì•ˆë…•í•˜ì„¸ìš”" stringByApplyingTransform:NSStringTransformLatinToHangul reverse:YES]);
// "annyeonghaseyo"
```

### Unicode åç§°

```swift
"ğŸ·".stringByApplyingTransform(NSStringTransformToUnicodeName, reverse: false)
// "{PIG FACE}"
```
```objective-c
NSLog(@"%@", [@"ğŸ·" stringByApplyingTransform:NSStringTransformToUnicodeName reverse:NO]);
// "{PIG FACE}"
```

### è§„æ ¼åŒ–ç”¨æˆ·è¾“å…¥

```swift
"Hello! ã“ã‚“ã«ã¡ã¯! à¸ªà¸§à¸±à¸ªà¸”à¸µ! Ù…Ø±Ø­Ø¨Ø§! æ‚¨å¥½!"
        .stringByApplyingTransform(NSStringTransformToLatin, reverse: false)?
        .stringByApplyingTransform(NSStringTransformStripDiacritics, reverse: false)?
        .localizedLowercaseString
        .componentsSeparatedByCharactersInSet(NSCharacterSet.whitespaceCharacterSet())
// ["hello!", "kon'nichiha!", "swasdi!", "mrhba!", "nin", "hao!"]
```
```objective-c
NSString *input = @"Hello! ã“ã‚“ã«ã¡ã¯! à¸ªà¸§à¸±à¸ªà¸”à¸µ! Ù…Ø±Ø­Ø¨Ø§! æ‚¨å¥½!";
NSString *processing = [input stringByApplyingTransform:NSStringTransformToLatin reverse:NO];
processing = [processing stringByApplyingTransform:NSStringTransformStripDiacritics reverse:NO];

NSArray<NSString *> *output = [processing.localizedLowercaseString
                               componentsSeparatedByCharactersInSet:[NSCharacterSet whitespaceCharacterSet]];
NSLog(@"%@", output);
// ["hello!", "kon'nichiha!", "swasdi!", "mrhba!", "nin", "hao!"]
```

æƒ³è¦äº†è§£æ›´å¤šï¼Œä¸€å®šä¸è¦é”™è¿‡ Mattt çš„ [`CFStringTransform`](http://nshipster.cn/cfstringtransform/)ã€‚


## CLLocationManager.requestLocation

Core Location åŒ…å«äº†ä¸€ä¸ªæ–°çš„è½»é‡ APIï¼Œç”¨æ¥å•æ¬¡è·å–ç”¨æˆ·ä½ç½®ä¿¡æ¯ã€‚`requestLocation()` ä½¿ç”¨å’Œè¿ç»­æ›´æ–°ä¸€æ ·çš„ä»£ç†æ–¹æ³•ï¼Œåœ¨å‘é€å®ŒæœŸæœ›ç²¾åº¦çš„ä½ç½®ä¿¡æ¯åï¼Œä¼šè‡ªåŠ¨å°†è‡ªå·±å…³é—­ï¼š

```swift
class ViewController : UIViewController, CLLocationManagerDelegate {
    let locationManager = CLLocationManager()
    // ...

    override func viewDidLoad() {
        super.viewDidLoad()

        locationManager.delegate = self
        locationManager.desiredAccuracy = kCLLocationAccuracyHundredMeters
        locationManager.requestLocation()
    }

   // MARK: - CLLocationManagerDelegate
    
    func locationManager(manager: CLLocationManager, didUpdateLocations locations: [CLLocation]) {
        if let location = locations.first {
            print("Current location: \(location)")
        } else {
            // ...
        }
    }
        
    func locationManager(manager: CLLocationManager, didFailWithError error: NSError) {
        print("Error finding location: \(error.localizedDescription)")
    }
}
```


## Swift åŒ–

iOS 9 å’Œ OS X 10.11 å¯¹ Cocoa API è¿›è¡Œäº†æ•°åƒé¡¹å°æ”¹è¿›ï¼Œä½¿ Swift äº’ç”¨æ€§å˜å¾—æ›´åŠ å®‰å…¨å’Œç®€å•ã€‚è¿™äº›æ”¹è¿›ä»ç†Ÿæ‚‰çš„ç©ºå€¼æ ‡æ³¨å¼€å§‹ï¼Œå°†éšå¼æ‰“å¼€åœ°å‚æ•°å’Œè¿”å›å€¼å˜ä¸ºçœŸæ­£çš„ Optional æˆ–è€…é Optional çš„æ•°æ®ç±»å‹ã€‚

æ¯”å¦‚ï¼Œè®¸å¤š API å°†ä»¥å‰ `NSArray` ç±»å‹çš„è¿”å›å€¼ä»ç©ºå€¼æ”¹ä¸ºäº†ç©ºæ•°ç»„ï¼Œè¯­ä¹‰ä¸Šçœ‹ï¼Œå®ƒä»¬æ˜¯åŒä¹‰çš„ï¼Œä½†æ˜¯é Optional æ•°ç»„æ˜“ç”¨å¾ˆå¤šã€‚æ­¤å¤–ï¼Œè®¸å¤š Cocoa API å¼€å§‹åˆ©ç”¨ Objective-C ä¸­æ–°åŠ å…¥çš„æ³›å‹è¯­æ³•æ¥æä¾›ç±»å‹åŒ–æ•°ç»„ã€‚å‰é¢æåˆ° `CLLocationManagerDelegate` ä¸­ `locationManager(_:didUpdateLocations:)` æ–¹æ³•å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªä¾‹å­ï¼šä¹‹å‰ `locations` å‚æ•°æ˜¯ `AnyObject` æ•°ç»„ï¼Œç°åœ¨å˜æˆäº† `CLLocation` æ•°ç»„ï¼Œä»è€Œçœå»äº†åœ¨æ–¹æ³•ä½“ä¸­è¿˜è¦å¦å¤–è½¬å‹çš„éº»çƒ¦ã€‚

æœ€åï¼Œè®¸å¤šä¹‹å‰ Swift æ ¹æœ¬æ— æ³•è®¿é—®çš„ API ä¹Ÿè¢«ä¿®æ­£äº†ï¼Œæ¯”å¦‚ï¼Œç”¨æ¥è·å–ç‰¹æ®Š `UIAppearance` çš„ä»£ç†æ–¹æ³•ã€‚è¿‡å»çš„ `appearanceWhenContainedIn:` æ˜¯ç”¨ C å¯å˜å‚æ•°å®ç°çš„ï¼›æ–°çš„ `appearanceWhenContainedInInstancesOfClasses(_:)` åˆ™ç”¨æ•°ç»„ä½œä¸ºå‚æ•°ï¼š

```swift
UIBarButtonItem.appearanceWhenContainedInInstancesOfClasses([UINavigationController.self]).tintColor = UIColor.redColor()
```
```objective-c
[UIBarButtonItem appearanceWhenContainedInInstancesOfClasses:@[[UINavigationController class]]].tintColor = [UIColor redColor];
```

> å¯ç¬‘çš„æ˜¯ï¼Œ Swift åœ¨æ¯æ¬¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶éƒ½ä¼šå´©æºƒã€‚ Beta æ¯•ç«Ÿæ˜¯ Beta å•Šã€‚



## NSFormatter å¢è¿›

Contacts æ¡†æ¶åŒ…å«äº†ç”¨äºæœ¬åœ°åŒ–è”ç³»äººå’Œåœ°å€çš„ `NSFormatter` å­ç±»ä»¥åŠä¸€ä¸ªæ–° Foundation `NSPersonNameComponentsFormatter` ç±»ã€‚æˆ‘ä»¬ä¼šåœ¨æœªæ¥å‡ å‘¨å†…è¯¦ç»†ä»‹ç»ï¼Œä¸è¿‡ç°åœ¨å…ˆæ¥çœ‹çœ‹ `NSNumberFormatter` å’Œ `NSDateFormatter` æœ‰å“ªäº›æ–°çš„äº®ç‚¹ã€‚

### NSNumberFormatter

é¦–å…ˆï¼ŒiOS 9 ä¸­ `NSNumberFormatter` å¢åŠ å››ä¸ªé¢å¤–æ ·å¼ï¼Œ`.OrdinalStyle`ç”¨äºå°†æ•°å­—è½¬æ¢ä¸ºåºæ•°å½¢å¼ï¼š

```swift
let formatter = NSNumberFormatter()
formatter.numberStyle = .OrdinalStyle

let numbers = [1, 2, 3, 4, 5]
numbers.map { formatter.stringFromNumber($0)! }
// ["1st", "2nd", "3rd", "4th", "5th"]
    
formatter.locale = NSLocale(localeIdentifier: "es")
numbers.map { formatter.stringFromNumber($0)! }
// ["1Âº", "2Âº", "3Âº", "4Âº", "5Âº"]
```
```objective-c
NSNumberFormatter *formatter = [[NSNumberFormatter alloc] init];
formatter.numberStyle = NSNumberFormatterOrdinalStyle;
NSArray<NSNumber *> *numbers = @[@1, @2, @3, @4, @5];

for (NSNumber *number in numbers) {
    NSLog(@"%@", [formatter stringFromNumber:number]);
}
// "1st", "2nd", "3rd", "4th", "5th"

formatter.locale = [NSLocale localeWithLocaleIdentifier:@"es"];
for (NSNumber *number in numbers) {
    NSLog(@"%@", [formatter stringFromNumber:number]);
}
// "1Âº", "2Âº", "3Âº", "4Âº", "5Âº"
```

å…¶æ¬¡ï¼Œç°æœ‰çš„ `.CurrencyStyle` æ–°å¢äº† `.CurrencyPluralStyle`ï¼Œ`.CurrencyISOCodeStyle` å’Œ `.CurrencyAccountingStyle`ã€‚å½“ä½¿ç”¨è¿™äº›æ–°æ ·å¼çš„æ—¶å€™ï¼Œç¡®ä¿ä½ çš„åŒºåŸŸè®¾ç½®ä¸­åŒ…å«è¯­è¨€*ä»¥åŠ*å›½å®¶å’Œåœ°åŒºï¼Œè¿™æ ·æ‰èƒ½ä¿è¯æ ¼å¼å™¨é€‰æ‹©æ­£ç¡®çš„è´§å¸å’Œè¡¨è¾¾ï¼š

```swift
let styles: [NSNumberFormatterStyle] = [.CurrencyStyle, .CurrencyPluralStyle, 
                .CurrencyISOCodeStyle, .CurrencyAccountingStyle]
formatter.locale = NSLocale(localeIdentifier: "en_US")
styles.map {
    formatter.numberStyle = $0
    return formatter.stringFromNumber(-125)!
}
// ["-$125.00", "-125.00 US dollars", "-USD125.00", "($125.00)"]

formatter.locale = NSLocale(localeIdentifier: "es_ES")
styles.map {
    formatter.numberStyle = $0
    return formatter.stringFromNumber(-125)!
}
// ["-125,00Â â‚¬", "-125,00 euros", "-125,00Â EUR", "-125,00Â â‚¬"]
```

### NSDateFormatter

å†æ¬¡ï¼Œç§° `setLocalizedDateFormatFromTemplate(_:)` ä¸º `NSDateFormatter` çš„æ–°æ–¹æ³•å¯èƒ½æœ‰ç‚¹å°†å°±ã€‚æ—©åœ¨ iOS 8 å®ƒå°±è¢«åŠ å…¥è¿›æ¥ï¼Œç›´åˆ°ä»Šå¹´çš„ Internationalization è®²åº§ä¸­æ‰è¢«å¤§å®¶æ‰€ç†ŸçŸ¥ã€‚è¿™ä¸ª*æ–°*æ–¹æ³•ä½¿å¾—å®šä¹‰æ—¥æœŸå’Œæ—¶é—´æ¨¡ç‰ˆå˜å¾—æå…¶ç®€å•ï¼›è™½ç„¶çœŸæ­£çš„æ ¼å¼åŒ–è¿˜æ˜¯ç”± `NSDateFormatter` æ¥å®Œæˆï¼š

```swift
let now = NSDate()

// full date and time
let fullFormatter = NSDateFormatter()
fullFormatter.setLocalizedDateFormatFromTemplate("yyyyMMMMddhhmm")
// month name and year only
let shortFormatter = NSDateFormatter()
shortFormatter.setLocalizedDateFormatFromTemplate("yyMMMM")

fullFormatter.stringFromDate(now)
// "June 23, 2015, 4:56 PM"
shortFormatter.stringFromDate(now)
// "June 15"

// switch locales to "de_DE"
fullFormatter.locale = NSLocale(localeIdentifier: "de_DE")
shortFormatter.locale = NSLocale(localeIdentifier: "de_DE")

fullFormatter.stringFromDate(now)
// "Juni 23, 2015, 4:56 nachm."
shortFormatter.stringFromDate(now)
// "Juni 15"
```


* * * 


å¥½äº†ï¼Œä»¥ä¸Šå°±æ˜¯ iOS 9 æ–° API çš„å¤§è‡´ä»‹ç»ï¼Œè™½ç„¶è¿˜æœ‰å¾ˆå¤šæˆ‘ä»¬æ²¡æœ‰æ¶‰åŠåˆ°çš„åœ°æ–¹ã€‚*ä½ *å¯¹ iOS 9 æˆ–è€… OS X 10.11 çš„å“ªäº›æ–°åŠŸèƒ½æœ€æ„Ÿå…´è¶£å‘¢ï¼Ÿå‚è€ƒä¸‹è‹¹æœçš„[å®˜æ–¹æ–‡æ¡£](https://developer.apple.com/library/prerelease/ios/releasenotes/General/iOS90APIDiffs/)ï¼Œç„¶å[å‘Šè¯‰æˆ‘ä»¬å§](https://twitter.com/nshipster)ï¼
